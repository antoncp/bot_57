# Геочат-бот когорты 57 Я.Практикум

### Описание
Бот доступен по ссылке [https://t.me/cogorta57_bot](https://t.me/cogorta57_bot)

Телеграмм-бот, в котором студенты когорты могут общаться с другими студентами, которые живут в одном городе с ними городе (стране, если за пределами РФ), планировать совместные активности и встречи. Бот показывает общую географию расположения студентов (сколько в каком городе или стране). Также бот показывает распределение студентов по часовым поясам и высчитывает среднее смещение от Гринвича и Москвы (может быть полезно при планировании вебинаров для учета удобного большинству времени проведения по самому массовому часовому поясу). Проект открыт для доработок и переработок, это самая простая начальная реализация. Весь исходный код доступен каждому студенту когорты, чтобы проверить какие данные сохраняются и как устроены под капотом те или иные функции (никакая персональная информация, кроме города и имени, не собирается и не сохраняется).   
### Технологии
`pyTelegramBotAPI` - библиотека для работы с API Телеграмма, простая для понимания и старта. 

`geopy` - геолокация координат пользователя или введенного географического названия. 

`timezonefinder` - определение часовой зоны пользователя по координатам. 

`pytz` - определение смещения часового пояса относительно UTC (Всемирного координированного времени).

`sqlite3` - база данных проекта. Одна таблица с колонками "Первичный ключ", "ID пользователя в Телеграмме", "Имя", "Город", "Страна", "Часовой пояс", "Смещение UTC".

Бот упакован в Docker-контейнер и задеплоен на [Digital ocean](https://www.digitalocean.com/). Постоянство базы данных обеспечено через подключение к контейнеру `bind mount` с файлом БД `sqlite`.

### Структура проекта
Проект состоит из следующих модулей:

`main.py` - основной модуль, который обеспечивает обработку всего взаимодействия с API Телеграмма, запуск и функционирование бота. Работа с пользователями происходит через отдельные объекты класса Пользователь, которые содержат в себе всю необходимую информацию о пользователе. При запуске/перезапуске модуля происходит инициализация БД проекта.  

`user.py` - модуль описывающий класс Пользователя, его атрибуты (такие как город, страна, часовой пояс...) и методы (например, запись или загрузка данных о пользователе из БД).

`db.py` - модуль взаимодействия с базой данных проекта SQLite, содержащий все необходимые методы чтения и записи в БД, а также открытия и закрытия соединения с БД.

`geo.py` - модуль обработки геоданных пользователя, перевода координат в название населенного пункта, проверки написания названия населенного пункта, определения часового пояса и смещения относительно UTC.

`texts.py` - фаил с длинными текстами, использованными в диалогах бота. Небольшие тексты оставлены в основном модуле. 
### Запуск и использование
1. Форкнуть и склонироваровать репозиторий 
    ```
    $ git clone git@github.com:antoncp/bot_57.git
    ``` 
2. Создать виртуальное окружение на основе **python 3.9** (использован на проекте)
    ```
    $ cd bot_57
    $ python3.9 -m venv venv
    $ source venv/bin/activate
    ``` 
3. Установить зависимости проекта
    ```
    (venv) $ pip install -r requirements.txt
    ```
4. Прописать свой ключ от Телеграмм-бота **'TEL_TOKEN'** в виртуальное окружение проекта.
### Развитие проекта
Данная реализация бота представляет собой лишь MVP (минимально жизнеспособный продукт), плюс-минус основанный на том, что мы уже прошли в обучении к данному времени. По мере расширения наших знаний - может расширяться функциональность и качество реализации бота. Некоторые первичные идеи:

- Добавить логирование работы бота, включая возникающие ошибки
- Добавить обработчики ошибок, улучшить архитектуру проекта и довести его до полного соответствия PEP8. Оформить документацию. 
- Мигрировать на "взрослую" базу данных, например, PostgreSQL
- Добавить функцию связи студентов, "застрявших" на одном и том же уроке спринта. Студент сообщает боту номер урока, который вызывает у него затруднение, бот ищет совпадения по другим студентам и связывает тех, кто пытается пройти один и тот же урок для общего мозгового штурма. 
- В случае доступа к API Пачки (есть только у администраторов чата), можно попробовать добавить интеграцию бота с Пачкой, например, чтобы бот автоматически форматировал вопрос в Пачку в соответствии с правилами идеально заданного вопроса (фото в комментарии и т.д.)
- Связать БД бота с сайтом на Джанго для веб-интерфеса взаимодействия с ботом, отображения городов студентов когорты на географической карте Яндекс или Google

Ну и главное. Учиться совместной работе на GitHub, созданию веток, их слиянию, пресловутым *pull request*. Каждый может дописать или переписать функции бота и предложить свои улучшения в репозиторий проекта. 


